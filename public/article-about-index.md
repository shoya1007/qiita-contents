---
title: DBのインデックスについて理解したので自分用にまとめる。
tags:
  - DB
  - DBMS
  - DB設計
private: true
updated_at: '2025-04-15T17:08:15+09:00'
id: c37c578f1edf932cfd29
organization_url_name: null
slide: false
ignorePublish: false
---
## この記事の内容について
数年前に買った「[達人に学ぶDB設計徹底指南書: 初級者で終わりたくないあなたへ](https://www.amazon.co.jp/%E9%81%94%E4%BA%BA%E3%81%AB%E5%AD%A6%E3%81%B6DB%E8%A8%AD%E8%A8%88-%E5%BE%B9%E5%BA%95%E6%8C%87%E5%8D%97%E6%9B%B8-%E5%88%9D%E7%B4%9A%E8%80%85%E3%81%A7%E7%B5%82%E3%82%8F%E3%82%8A%E3%81%9F%E3%81%8F%E3%81%AA%E3%81%84%E3%81%82%E3%81%AA%E3%81%9F%E3%81%B8-%E3%83%9F%E3%83%83%E3%82%AF/dp/4798124702)」を全然読んでいなかったので今回読んでみたら、自分があまり理解できていなかったDBのインデックスについて理解することができたので、読んで分かったことを自分用にメモとして残す記事。

## 読む前の自分について
今回読んだ本を読む前の自分の、DBのインデックスに対する理解度は以下のような感じ。

- インデックスってなんか聞いたことある。
- 使うとパフォーマンスが良くなるらしい。
- どうやって活用するんだろう。
- どこにインデックスを張るのがいいんだろう。

こんな感じでインデックスについて何もわからないというような状態だったが、今回本書を読んだことでインデックスに対する理解度が上がったと思う。

## インデックスについての説明
インデックスを理解するにあたっては、本の索引をイメージすると良い。
特定の単語がどのページに記載されているかを見つけたいときに、本の1ページ目から順々にめくって探していくのは非効率。そこで、本の索引を使うと、この手間を省略して、目的の単語がどのページに記載されているかを素早く見つけることができる。
インデックスはこれと似ていて、特定の列にインデックスを設定していると、求めているデータを見つけ出す際に効率よく見つけることができるようになる。
データベース設計時に、どの列にインデックスを設定するかによってデーターベースのパフォーマンスが変わってくる。

## テーブルへのアクセスにおいてはインデックスを意識することはない
普段エンジニアがSQLを用いたDBMSのテーブルのデータの参照などを行う際には、インデックスを意識することはない。なぜなら、インデックスを使うかどうかはDBMS自身が内部で勝手に判断しているため。
DBMS内ではテーブルとインデックスそれぞれが異なるファイルとして管理されており、本書内ではインデックスは「DBMS内にテーブルとは独立に保持されるオブジェクト」と表現されている。

## インデックスを使う理由
インデックスはSQLのパフォーマンスを改善するための手段としてとてもポピュラーなものです。その理由は以下のような特徴によるもの。
- アプリケーションのコードに影響を与えない。（アプリケーション透過的）
- テーブルのデータに影響を与えない。（データ透過的）
- 上記2点の特徴を持っているうえに、性能改善の効果が大きい。

インデックスによる性能改善は、正しい指標を理解して使うことでデメリットよりもメリットが大きく上回るかたちで成果が出るといわれている。

## インデックスにはいくつか種類がある
インデックスには以下のようなものがあり、DBMSによって使用できる種類に差がある。
- B-treeインデックス
- ビットマップインデックス
- ハッシュインデックス

通常、DBMSでオプションなどをつけずにインデックスを作成するとB-treeインデックスが作成されるので、まずはB-treeインデックスを覚えておくと良い。

## B-treeについて
B-tree の構造は、木構造でデータを保持する。実データに対するポインタを最下層のリーフと呼ばれるノードが保持する。
B-tree の構造の特徴は以下。
- 均一性
- 持続性
- 処理汎用性
- 非等値性
- 親ソート性

## インデックスはどの列に張るか
ここまでで、インデックスを張ってしまえばDB内のデータを参照するときにインデックスを意識する必要がないことはわかったが、インデックスのメリットを享受するためには、どの列にインデックスを張るべきなのか。
本書を読んだ結果、以下の方針で決めればよさそうということがわかった。
- 大規模なテーブルに対して張る。
- カーディナリティの高い列に張る。
  - カーディナリティとは、特定の列の値がどのぐらいの種類の多さを持つかということを表す概念。インデックスを張るかどうかを判断するうえでの重要な情報となる。
  - 本書では性別を例に出している。「性別」という列がある場合、その列が持つ値として考えられるのは「男性」「女性」「不祥」。この時、カーディナリティは 3 になる。
- SQL文で WHERE 句の選択条件や結合条件に使われている列に張る。

## その他注意事項
### 主キー制約や一意制約の列にはインデックスは不要
主キー制約や一意制約が作成される場合、DBMSは内部的にその列にインデックスを張るため。

### インデックスは更新性能を劣化させる
インデックスがテーブルから独立したオブジェクトとしてDBMSで保持されており、インデックスが張られている列の値が変更されればインデックス内で保持している値も変更する必要があるから。

### 定期的なメンテナンスが必要
前述のようにインデックスによる性能劣化などがあるため、長期的な運用においてはインデックスの再構築のような定期的なメンテナンスを行うことが望ましい。
